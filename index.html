<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>setHacked Bookmark Viewer</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#121212">
    <meta name="description" content="setHacked Bookmark Viewer">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
</head>

<body>
    <div id="appLoader" class="app-loader" role="status" aria-live="polite">
        <div class="loader-core">
            <div class="loader-ring"></div>
            <div class="loader-pulse"></div>
            <p class="loader-text">Initializing layoutâ€¦</p>
        </div>
    </div>
    <header class="app-header">
        <div class="header-brand">
            <h1 id="title">setHacked Bookmark Viewer</h1>
            <div id="timestampDisplay" class="timestamp-display">Data Timestamp: </div>
        </div>
        <div class="header-controls">
            <button id="layoutLockButton" type="button" aria-label="Lock the current layout" aria-pressed="false">Lock Layout</button>
            <div class="module-preferences-container">
                <button id="modulePreferencesButton" type="button" aria-label="Toggle module visibility" aria-haspopup="true" aria-expanded="false">Modules</button>
                <div id="modulePreferencesPanel" class="module-preferences" role="menu" aria-hidden="true"></div>
            </div>
            <button id="prevVersionButton" aria-label="Load the previous version">Previous Version</button>
            <button id="nextVersionButton" aria-label="Load the next version">Next Version</button>
            <button id="clearDBButton" aria-label="Clear all stored data">Clear Data</button>
            <button id="helpButton" aria-label="Help">Help</button>
            <button id="discordButton" aria-label="Join the discord">Join Discord</button>
        </div>
        <div id="errorContainer" class="error-message" aria-label="Error message"></div>
    </header>

    <main>
        <section id="moduleGrid" class="module-grid" aria-label="Workspace modules">
            <article class="module" data-module-id="map" data-grid-w="6" data-grid-h="4">
                <header class="module-header">
                    <h2>Map</h2>
                </header>
                <div class="module-body">
                    <div id="mapContainer" class="module-scrollable" aria-label="Graphical map view"></div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="bookmarks" data-grid-w="6" data-grid-h="5">
                <header class="module-header">
                    <h2>Bookmarks</h2>
                </header>
                <div class="module-body">
                    <div class="module-legend" id="bookmarkLegend">
                        <span class="legend-item legend-missing">Needs scan</span>
                        <span class="legend-item legend-stale">Stale bookmark</span>
                        <span class="legend-item legend-matched">Matched</span>
                    </div>
                    <button id="readClipboardButton" aria-label="Read data from the clipboard">Read Clipboard</button>
                    <div id="tableContainer" class="module-scrollable" aria-label="Data table view"></div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="signatures" data-grid-w="4" data-grid-h="5">
                <header class="module-header">
                    <h2>Signatures</h2>
                    <div class="module-status" id="signatureActiveSystem">No system selected</div>
                </header>
                <div class="module-body signature-module">
                    <div class="signature-controls">
                        <button id="readSignaturesButton" type="button" disabled>Read Clipboard</button>
                        <button id="clearSignaturesButton" type="button" disabled>Clear</button>
                        <button id="signatureHistoryBackButton" type="button" disabled>Back</button>
                        <button id="signatureHistoryForwardButton" type="button" disabled>Forward</button>
                        <button id="wormholeTutorialButton" type="button" aria-haspopup="dialog">Bookmarking Tutorial</button>
                    </div>
                    <div id="signatureMessage" class="signature-message" aria-live="assertive"></div>
                    <div class="module-legend signature-legend">
                        <span class="legend-item legend-missing">Needs scan</span>
                        <span class="legend-item legend-stale">Removable</span>
                        <span class="legend-item legend-matched">Matched</span>
                    </div>
                    <div id="signatureTableContainer" class="module-scrollable signature-table-container" aria-live="polite"></div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="intel" data-grid-w="5" data-grid-h="5">
                <header class="module-header">
                    <h2>System Intel</h2>
                    <div class="module-status" id="intelActiveSystem">No system selected</div>
                </header>
                <div class="module-body intel-module">
                    <label class="intel-nickname-label" for="intelNicknameInput">Nickname</label>
                    <input id="intelNicknameInput" class="intel-nickname-input" type="text" placeholder="Set a nickname for this system..." disabled>
                    <textarea id="intelTextarea" class="intel-textarea" placeholder="Add intel for this system..." disabled></textarea>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="stats" data-grid-w="4" data-grid-h="4">
                <header class="module-header">
                    <h2>Statistics</h2>
                </header>
                <div class="module-body stats-module">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Bookmarks</div>
                            <div class="stat-value" id="statsTotalBookmarks">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Systems</div>
                            <div class="stat-value" id="statsTotalSystems">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Connections</div>
                            <div class="stat-value" id="statsTotalConnections">0</div>
                        </div>
                    </div>
                    <div class="stats-leaderboard">
                        <h3>Connection Leaderboard</h3>
                        <ol id="statsLeaderboard" class="stats-leaderboard-list"></ol>
                        <div id="statsLeaderboardEmpty" class="stats-empty">No connections detected.</div>
                    </div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>
        </section>
    </main>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <img src="assets/images/help.png" alt="Help instructions">
        </div>
    </div>

    <div id="wormholeTutorialModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="wormholeTutorialTitle" aria-describedby="wormholeTutorialBody">
        <div class="modal-content tutorial-modal-content">
            <header class="tutorial-modal-header">
                <h3 id="wormholeTutorialTitle" class="tutorial-modal-title">Bookmarking Wormholes</h3>
                <button id="wormholeTutorialCloseButton" type="button" class="tutorial-modal-close" aria-label="Close tutorial">&times;</button>
            </header>
            <div id="wormholeTutorialBody" class="tutorial-modal-body">
                <p class="tutorial-intro">Follow these steps to capture matching IN and OUT bookmarks without missing any details.</p>
                <ol class="tutorial-steps" start="1">
                    <li>Scan down the wormhole.</li>
                    <li>Scan down a wormhole.</li>
                    <li>Copy the signatures table in game into your clipboard.</li>
                    <li>Switch to the bookmark viewer app and press the Read Clipboard button in the Signatures module.</li>
                    <li>Switch back to the game and open the Show Info window and the Save Location window for that wormhole.</li>
                    <li>Drag the wormhole picture from Show Info into the bookmark note section, then press Enter for the next line.</li>
                    <li>Copy everything in the Show Info window and paste it into the bookmark note under the wormhole name.</li>
                    <li>Copy the full note text so it is on your clipboard.</li>
                    <li>Switch to the bookmark viewer app and press IN BM for that wormhole signature.</li>
                    <li>Your clipboard text will be filled with the label needed for that bookmark.</li>
                    <li>Paste the label in-game for the bookmark and press Save.</li>
                    <li>Edit that bookmark and leave the window open.</li>
                    <li>Jump through the wormhole.</li>
                    <li>Open the bookmark tool again for the same signature from the first system and press OUT BM.</li>
                    <li>Your clipboard will be filled with the label needed for the exit bookmark.</li>
                    <li>Paste the label in-game for the exit bookmark and press Save.</li>
                </ol>
            </div>
            <footer class="tutorial-modal-footer">
                <button id="wormholeTutorialConfirmButton" type="button" class="tutorial-dismiss-button">Got it</button>
            </footer>
        </div>
    </div>

    <noscript>
        <p class="noscript-message">JavaScript is required to use this application. Please enable JavaScript in your browser settings.</p>
    </noscript>

    <!-- External Libraries -->
    <script src="https://unpkg.com/idb@6.1.3/build/iife/index-min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <!-- Application Scripts -->
    <script type="module" src="js/db.js"></script>
    <script type="module" src="js/table.js"></script>
    <script type="module" src="js/stats.js"></script>
    <script type="module" src="js/layout.js"></script>
    <script type="module" src="js/signatures.js"></script>
    <script type="module" src="js/intel.js"></script>
    <script type="module" src="js/map.js"></script>
    <script type="module" src="js/clipboard.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/main.js"></script>
    <script>
        console.log('index.html loaded');
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>

</html>
