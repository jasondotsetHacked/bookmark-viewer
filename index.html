<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>setHacked Bookmark Viewer</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#121212">
    <meta name="description" content="setHacked Bookmark Viewer">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
</head>

<body>
    <div id="appLoader" class="app-loader" role="status" aria-live="polite">
        <div class="loader-core">
            <div class="loader-ring"></div>
            <div class="loader-pulse"></div>
            <p class="loader-text">Initializing layoutâ€¦</p>
        </div>
    </div>
    <header class="app-header">
        <div class="header-brand">
            <h1 id="title">setHacked Bookmark Viewer</h1>
            <div id="timestampDisplay" class="timestamp-display">Data Timestamp: </div>
        </div>
        <div class="header-controls">
            <button id="layoutLockButton" type="button" aria-label="Lock the current layout" aria-pressed="false">Lock Layout</button>
            <button id="prevVersionButton" aria-label="Load the previous version">Previous Version</button>
            <button id="nextVersionButton" aria-label="Load the next version">Next Version</button>
            <button id="clearDBButton" aria-label="Clear all stored data">Clear Data</button>
            <button id="helpButton" aria-label="Help">Help</button>
            <button id="discordButton" aria-label="Join the discord">Join Discord</button>
        </div>
        <div id="errorContainer" class="error-message" aria-label="Error message"></div>
    </header>

    <main>
        <section id="moduleGrid" class="module-grid" aria-label="Workspace modules">
            <article class="module" data-module-id="map" data-grid-w="6" data-grid-h="4">
                <header class="module-header">
                    <h2>Map</h2>
                </header>
                <div class="module-body">
                    <div id="mapContainer" class="module-scrollable" aria-label="Graphical map view"></div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="bookmarks" data-grid-w="6" data-grid-h="5">
                <header class="module-header">
                    <h2>Bookmarks</h2>
                </header>
                <div class="module-body">
                    <div class="module-legend" id="bookmarkLegend">
                        <span class="legend-item legend-missing">Needs scan</span>
                        <span class="legend-item legend-stale">Stale bookmark</span>
                        <span class="legend-item legend-matched">Matched</span>
                    </div>
                    <button id="readClipboardButton" aria-label="Read data from the clipboard">Read Clipboard</button>
                    <div id="tableContainer" class="module-scrollable" aria-label="Data table view"></div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="signatures" data-grid-w="4" data-grid-h="5">
                <header class="module-header">
                    <h2>Signatures</h2>
                    <div class="module-status" id="signatureActiveSystem">No system selected</div>
                </header>
                <div class="module-body signature-module">
                    <div class="signature-controls">
                        <button id="readSignaturesButton" type="button" disabled>Read Clipboard</button>
                        <button id="clearSignaturesButton" type="button" disabled>Clear</button>
                    </div>
                    <div id="signatureMessage" class="signature-message" aria-live="assertive"></div>
                    <div class="module-legend signature-legend">
                        <span class="legend-item legend-missing">Needs scan</span>
                        <span class="legend-item legend-stale">Removable</span>
                        <span class="legend-item legend-matched">Matched</span>
                    </div>
                    <div id="signatureTableContainer" class="module-scrollable signature-table-container" aria-live="polite"></div>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>

            <article class="module" data-module-id="intel" data-grid-w="5" data-grid-h="5">
                <header class="module-header">
                    <h2>System Intel</h2>
                    <div class="module-status" id="intelActiveSystem">No system selected</div>
                </header>
                <div class="module-body intel-module">
                    <label class="intel-nickname-label" for="intelNicknameInput">Nickname</label>
                    <input id="intelNicknameInput" class="intel-nickname-input" type="text" placeholder="Set a nickname for this system..." disabled>
                    <textarea id="intelTextarea" class="intel-textarea" placeholder="Add intel for this system..." disabled></textarea>
                </div>
                <div class="module-resize-handle" aria-hidden="true"></div>
            </article>
        </section>
    </main>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <img src="assets/images/help.png" alt="Help instructions">
        </div>
    </div>

    <noscript>
        <p class="noscript-message">JavaScript is required to use this application. Please enable JavaScript in your browser settings.</p>
    </noscript>

    <!-- External Libraries -->
    <script src="https://unpkg.com/idb@6.1.3/build/iife/index-min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <!-- Application Scripts -->
    <script type="module" src="js/db.js"></script>
    <script type="module" src="js/table.js"></script>
    <script type="module" src="js/layout.js"></script>
    <script type="module" src="js/signatures.js"></script>
    <script type="module" src="js/intel.js"></script>
    <script type="module" src="js/map.js"></script>
    <script type="module" src="js/clipboard.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/main.js"></script>
    <script>
        console.log('index.html loaded');
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
        }
    </script>
</body>

</html>
